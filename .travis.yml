language: go
sudo: required
go:
  - "1.11"
services:
  - docker

env: GO111MODULE=on

install:
  - go get -u golang.org/x/lint/golint
  - go mod download
  - docker pull ipfs/go-ipfs:v0.4.18

before_script:
  - go vet ./...
  - go build ./...
  - go test -run xxxx ./...
  - make testenv

script:
  - diff -u <(echo -n) <(gofmt -d -s `find . -type f -name '*.go' -not -path "./vendor/*"`)
  - diff -u <(echo -n) <(golint `go list ./... | grep -v /vendor/`)
  - sudo -E env "PATH=$PATH" go test -race -short -coverprofile=coverage.txt ./...

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_deploy:
  - make release

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: AqKkjWZLJdmuZSK055dfCeJCJtwxAlE7dE5M9rLKapbrTu2MzGvtgY+HHwADVBM7p+eKzwTaS5BzGxPy64q0nWsYpOoATXHB+xbt0xHipy4sCIaq2E9K+caiIRza1kQDu6MzQg4AA937Tktjv2FVv/Yr306tNZg5EJsejovbq68f4KQYZQrM9YUCIR3lc43ZgchFhMfcLQn2RMaHcRGg98sT9cYN9Bm8qktOK/xEspDD/bfsG9+iogO4QCEfALj1QxPnq6GhXei3bOOfnRK/l0r/hQnkRApSQ8Z5Ev1/RW1RdP3eFfGIH8jyOL68slyJ6+vSkKYOB9hbT2nB1XRYtJb3ZTDAaH0J8z/u6BtW5ZvziFvIE47LEyHIdYPiTMFwgShOckq5qbd6WrQdN6uFOIrImQERHXEV+f8Y4PHBS9SJVYG/JtPLOVjQOly/mqG0mw2ALVsRgd7c+BlhHZ7JKm5WjR0J2nXkn18JgjKHJNT0vz+As6GNkMWWaj2nsameA10O1+vXEp8G4mZWuIk9DLBcGcomFL1E6UQc9M+cTvpxxlCIc/x7aEHd5KsGAyOWPDgszwxKwqd2Lmi1pJmrsu5ri4briJhSyhuuEhcyS+KS2ImpVDRAjxvGelcmSiH5/8owzoonZ8b6LP9N3Bcuco9JTmJdqcPfSmr5F0vBvWE=
  file_glob: true
  file: release/nexus-*
  on:
    tags: true
    repo: RTradeLtd/Nexus

notifications:
  email: false
